<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <title>NR Map Pattern Code</title>
</head>

<body>
    <input id="input" oninput="onChange()" />
    <br>
    <div id="output"></div>

    <script>
        var data = null
        fetch("data.json").then(async (response) => {
            data = await response.json()
            onChange()
        })

        const nightlords = [
            "Gladius",
            "Adel",
            "Gnoster",
            "Maris",
            "Libra",
            "Fulghor",
            "Caligo",
            "Heolstor",
        ]

        const shifting_earths = [
            "Mountaintop",
            "Crater",
            "Rotted Woods",
            "Noklateo",
        ]

        function onChange() {
            const output = document.getElementById("output")
            if (data == null) {
                output.innerHTML = "Loading..."
                return
            }

            const input = document.getElementById("input")
            const code = input.value.toUpperCase()
            input.value = code
            if (code.length == 0) {
                output.innerHTML = ""
                return
            }

            var matched = ""
            for (let i = 0; i < data.length; ++i) {
                if (code == data[i].substring(0, code.length)) {
                    const pattern_id = i.toString().padStart(3, "0")
                    const nightlord = nightlords[Math.floor(i * nightlords.length / 320)]
                    const shifting_earth = i % 40 < 20 ? "Default" : shifting_earths[Math.floor(i % 20 * shifting_earths.length / 20)]
                    matched += `<a href="https://marunanya.github.io/nightreign-map-pattern/pattern/${pattern_id}.jpg">${pattern_id} - ${nightlord} - ${shifting_earth}</a><br>`
                }
            }
            output.innerHTML = matched
        }
    </script>
</body>

</html>